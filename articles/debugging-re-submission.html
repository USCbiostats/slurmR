<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Re-submission and debugging • slurmR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Re-submission and debugging">
<meta property="og:description" content="slurmR">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-108627422-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-108627422-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">slurmR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5-1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/debugging-re-submission.html">Re-submission and debugging</a>
    </li>
    <li>
      <a href="../articles/getting-started.html">Getting Started with slurmR</a>
    </li>
    <li>
      <a href="../articles/working-with-slurm.html">Working with Slurm</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/USCbiostats/slurmR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="debugging-re-submission_files/header-attrs-2.10/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Re-submission and debugging</h1>
                        <h4 class="author">George G. Vega Yon</h4>
            
            <h4 class="date">2021-09-03 (Last revision Feb 13, 2020)</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/USCbiostats/slurmR/blob/master/vignettes/debugging-re-submission.Rmd"><code>vignettes/debugging-re-submission.Rmd</code></a></small>
      <div class="hidden name"><code>debugging-re-submission.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Want it or not, a lot of times jobs fail. In such cases, it could be hard to figure out what went wrong. The <code>slurmR</code> package has some tools that can help you deal with this.</p>
<p>The documentation that follows applies for job submitted with sbatch, this is, job that were submitted using either <code>Slurm_lapply</code>, <code>Slurm_sapply</code>, <code>Slurm_Map</code>, or <code>Slurm_EvalQ</code>.</p>
</div>
<div id="checking-logs" class="section level1">
<h1 class="hasAnchor">
<a href="#checking-logs" class="anchor"></a>Checking logs</h1>
<p>When calling any of the <code>*apply</code> family functions, <code>slurmR</code> creates a folder with the name equal to <code>job_name</code> in <code>tmp_path</code> as follows:</p>
<ul>
<li><p><code>00-rscript.r</code>: The R script that is used to load the data, and execute whatever the instruction is (<code>sapply</code>, <code>lapply</code>, <code>Map</code>, etc.).</p></li>
<li><p><code>01-bash.sh</code>: The Slurm configuration bash file. This passes all the SBATCH options the user specified and calls <code>Rscript</code> to submit the job.</p></li>
<li><p><code>02-output-%A-%a.out</code>: The name-pattern for the log files generated by Rscript. In the case of job-arrays, the pattern <code>%A</code> is the jobid and <code>%a</code> is the Array id. This is usually the place where to look for useful information on why the script failed.</p></li>
<li><p><code>03-answer-%03i.rds</code>: The name pattern of the output <code>rds</code> files. Usually, the jobs end-up writing an output, e.g. the results from the <code>lapply</code> call, and the <code>%i</code> in the pattern indicates the array id.</p></li>
<li><p><code>*.rds</code> Further R objects that were exported for this particular job. In the case of <code>Slurm_lapply</code>, for example, it usually includes <code>X1.rds</code>, <code>X2.rds</code>, …, <code>X[njobs].rds</code> files. Other R objects needed for the call will be saved in this same folder as well.</p></li>
</ul>
<p>If there’s an issue with the submitted job, the user can take a look at these files. In general, looking at the log files is enough to figure out what could be going on. Let’s see the following example:</p>
<ol style="list-style-type: decimal">
<li>We are submitting a job that runs a complicated algorithm</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/USCbiostats/slurmR">slurmR</a></span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Slurm_Map.html">Slurm_lapply</a></span><span class="op">(</span>
  <span class="fl">1</span><span class="op">:</span><span class="fl">1000</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">complicated_algorithm</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,
  njobs <span class="op">=</span> <span class="fl">4</span>,
  plan <span class="op">=</span> <span class="st">"submit"</span>
  <span class="op">)</span></code></pre></div>
<p>By printing the output, you may see something like this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  Call<span class="sc">:</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">Slurm_lapply</span>(<span class="at">X =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">complicated_algorithm</span>(x), <span class="at">njobs =</span> <span class="dv">4</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">plan =</span> <span class="st">"submit"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>job_name <span class="sc">:</span> slurmr<span class="sc">-</span>job<span class="sc">-</span>5724cb1616</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>tmp_path <span class="sc">:</span> <span class="er">/</span>auto<span class="sc">/</span>rcf<span class="dv">-40</span><span class="sc">/</span>vegayon<span class="sc">/</span>slurmR<span class="sc">/</span>slurmr<span class="sc">-</span>job<span class="sc">-</span>5724cb1616</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>job ID   <span class="sc">:</span> <span class="dv">6163924</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>Status<span class="sc">:</span> All jobs are pending resource allocation or are on it<span class="st">'s way to start. (Code 1)</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="st">This is a job array. The status of each job, by array id, is the following:</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="st"> done      :  -</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="st"> failed    :  -</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="st"> pending   :  -</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="st"> running   :  1, 2, 3, 4.</span></span></code></pre></div>
<p>The problem is, what happens if one of these fails, for example, 1 and 3:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  Call<span class="sc">:</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">Slurm_lapply</span>(<span class="at">X =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">complicated_algorithm</span>(x), <span class="at">njobs =</span> <span class="dv">4</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">plan =</span> <span class="st">"submit"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>job_name <span class="sc">:</span> slurmr<span class="sc">-</span>job<span class="sc">-</span>5724cb1616</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>tmp_path <span class="sc">:</span> <span class="er">/</span>auto<span class="sc">/</span>rcf<span class="dv">-40</span><span class="sc">/</span>vegayon<span class="sc">/</span>slurmR<span class="sc">/</span>slurmr<span class="sc">-</span>job<span class="sc">-</span>5724cb1616</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>job ID   <span class="sc">:</span> <span class="dv">6163924</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>Status<span class="sc">:</span> One or more jobs <span class="fu">failed.</span> (Code <span class="dv">99</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>This is a job array. The status of each job, by array id, is the following<span class="sc">:</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a> done      <span class="sc">:</span>  <span class="dv">2</span>, <span class="fl">4.</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a> failed    <span class="sc">:</span>  <span class="dv">1</span>, <span class="fl">3.</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a> pending   <span class="sc">:</span>  <span class="sc">-</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a> running   <span class="sc">:</span>  <span class="sc">-</span></span></code></pre></div>
<p>We can check the log-files of the failed jobs using <code>Slurm_log</code>, for example, if we wanted to checkout the log-file of the first job of the array, we can type:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/Slurm_log.html">Slurm_log</a></span><span class="op">(</span><span class="va">x</span>, which. <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>By default, while in interactive mode, you will get a prompt telling you that <code>less</code> (the default) will be called using the <code>system2</code> command, and asking you if you wish to continue. You can change the way to checkout the log file by using an alternative command, like <code>cat</code>, e.g.:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/Slurm_log.html">Slurm_log</a></span><span class="op">(</span><span class="va">x</span>, which. <span class="op">=</span> <span class="fl">1</span>, cmd <span class="op">=</span> <span class="st">"cat"</span><span class="op">)</span></code></pre></div>
<p>Again, while in interactive mode, you will get a prompt asking you to enter <code>"y"</code> or <code>"n"</code>. If the command fails, it is usually due to a missing log, either you entered an invalid number in <code>which.</code>, or the job-array didn’t started the log-file. If the error has to do with the later, then you can always inspect the files located in the job folder using command line tools:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cd /path-to-the-temp-dir/path-to-the-job-name/</span></code></pre></div>
</div>
<div id="job-resubmission" class="section level1">
<h1 class="hasAnchor">
<a href="#job-resubmission" class="anchor"></a>Job-resubmission</h1>
<p>Following the previous case, let’s imagine that the failure was due to some unexpected error (the node failed), so we can resubmit the job, in order to do such, we can use the function <code>sbatch</code> like it follows:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Recall that x is a slurm_job object</span>
<span class="fu"><a href="../reference/slurm_available.html">sbatch</a></span><span class="op">(</span><span class="va">x</span>, array <span class="op">=</span> <span class="st">"1,3"</span><span class="op">)</span></code></pre></div>
<p>This will re-submit the job, but only the components 1 and 3. Once it is done, the user can collect the results using <code>Slurm_collect</code>. This will read in the results of all jobs, not just 1 and 3.</p>
<p>If for some reason the R session was closed before been able to save the <code>slurm_job</code> object, users can always recover the <code>slurm_job</code> object by using the <code>read_slurm_job</code> function, e.g.:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Starting from a fresh session</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/USCbiostats/slurmR">slurmR</a></span><span class="op">)</span>

<span class="co"># By typing the path to the job folder, slurmR will recover the job</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slurm_job.html">read_slurm_job</a></span><span class="op">(</span><span class="st">"/path-to-the-temp-dir/path-to-the-job-name/"</span><span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by George Vega Yon, National Cancer Institute (NCI).</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
