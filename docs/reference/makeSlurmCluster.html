<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Create a Parallel Socket Cluster using Slurm — makeSlurmCluster • slurmR</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />
<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Create a Parallel Socket Cluster using Slurm — makeSlurmCluster" />

<meta property="og:description" content="This function is essentially a wrapper of the function parallel::makePSOCKcluster.
makeSlurmCluster main feature is adding node addresses." />

<meta property="og:image" content="/logo.png" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">slurmR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/getting-started.html">Getting Started with slurmR</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/USCbiostats/slurmR">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create a Parallel Socket Cluster using Slurm</h1>
    <small class="dont-index">Source: <a href='https://github.com/USCbiostats/slurmR/blob/master/R/makeSlurmCluster.R'><code>R/makeSlurmCluster.R</code></a></small>
    <div class="hidden name"><code>makeSlurmCluster.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>This function is essentially a wrapper of the function <a href='https://www.rdocumentation.org/packages/parallel/topics/makeCluster'>parallel::makePSOCKcluster</a>.
<code>makeSlurmCluster</code> main feature is adding node addresses.</p>
    
    </div>

    <pre class="usage"><span class='fu'>makeSlurmCluster</span>(<span class='no'>n</span>, <span class='kw'>job_name</span> <span class='kw'>=</span> <span class='fu'><a href='random_job_name.html'>random_job_name</a></span>(),
  <span class='kw'>tmp_path</span> <span class='kw'>=</span> <span class='no'>opts_slurmR</span>$<span class='fu'>get_tmp_path</span>(), <span class='kw'>cluster_opt</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(),
  <span class='kw'>max_wait</span> <span class='kw'>=</span> <span class='fl'>300L</span>, <span class='kw'>verb</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='no'>...</span>)

<span class='co'># S3 method for slurm_cluster</span>
<span class='fu'>stopCluster</span>(<span class='no'>cl</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>n</th>
      <td><p>Integer scalar. Size of the cluster object (see details).</p></td>
    </tr>
    <tr>
      <th>job_name</th>
      <td><p>Character. Name of the job to be passed to <code>Slurm</code>.</p></td>
    </tr>
    <tr>
      <th>tmp_path</th>
      <td><p>Character. Path to the directory where all the data (including
scripts) will be stored. Notice that this path must be accessible by all the
nodes in the network (See <a href='opts_slurmR.html'>opts_slurmR</a>).</p></td>
    </tr>
    <tr>
      <th>cluster_opt</th>
      <td><p>A list of arguments passed to <a href='https://www.rdocumentation.org/packages/parallel/topics/makeCluster'>parallel::makePSOCKcluster</a>.</p></td>
    </tr>
    <tr>
      <th>max_wait</th>
      <td><p>Integer scalar. Wait time before exiting with error while
trying to read the nodes information.</p></td>
    </tr>
    <tr>
      <th>verb</th>
      <td><p>Logical scalar. If <code>TRUE</code>, the function will print messages on
screen reporting on the status of the job submission.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Further arguments passed to <a href='Slurm_EvalQ.html'>Slurm_EvalQ</a> via <code>sbatch_opt</code>.</p></td>
    </tr>
    <tr>
      <th>cl</th>
      <td><p>An object of class <code>slurm_cluster</code>.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A object of class <code><a href='https://www.rdocumentation.org/packages/base/topics/c'>c("slurm_cluster", "SOCKcluster", "cluster")</a></code>. It
is the same as what is returned by <a href='https://www.rdocumentation.org/packages/parallel/topics/makeCluster'>parallel::makePSOCKcluster</a> with the main
difference that it has two extra attributes:</p><ul>
<li><p><code>SLURM_JOBID</code> Which is the id of the Job that initialized tha cluster.</p></li>
</ul>

    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>By default, if the <code>time</code> option is not specified via <code>...</code>,
then it is set to the value <code>01:00:00</code>, this is, 1 hour.</p>
<p>Once a job is submitted via Slurm, the user gets access to the nodes
associated with it, which allows users to star new processes within those.
By means of this, we can create Socket, also knwon as "PSOCK", clusters across
nodes in a Slurm environment. The name of the hosts are retrieved and passed
later on to <a href='https://www.rdocumentation.org/packages/parallel/topics/makeCluster'>parallel::makePSOCKcluster</a>.</p>
<p>The method <code>stopCluster</code> for <code>slurm_cluster</code> stops the cluster doing
the following:</p><ol>
<li><p>Closes the conection by calling the <code>stopCluster</code> method for <code>PSOCK</code> objects.</p></li>
<li><p>Cancel the Slurm job using <code>scancel</code>.</p></li>
</ol>
    
    <h2 class="hasAnchor" id="maximum-number-of-connections"><a class="anchor" href="#maximum-number-of-connections"></a>Maximum number of connections</h2>

    
    <p>By default, R limits the number of simultaneous connections (see this thread
in R-sig-hpc <a href='https://stat.ethz.ch/pipermail/r-sig-hpc/2012-May/001373.html'>https://stat.ethz.ch/pipermail/r-sig-hpc/2012-May/001373.html</a>)
Current maximum is 128 (R version 3.6.1). To modify that limit, you would need
to reinstall R updating the macro <code>NCONNECTIONS</code> in the file <code>src/main/connections.c</code>.</p>
<p>For now, if the user sets <code>n</code> above 128 it will get an immediate warning
pointing to this issue, in particular, specifying that the cluster object
may not be able to be created.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='co'># Creating a cluster with 100 workers/offpring/child R sessions</span>
<span class='no'>cl</span> <span class='kw'>&lt;-</span> <span class='fu'>makeSlurmCluster</span>(<span class='fl'>100</span>)

<span class='co'># Computing the mean of a 100 random uniforms within each worker</span>
<span class='co'># for this we can use any of the function available in the parallel package.</span>
<span class='no'>ans</span> <span class='kw'>&lt;-</span> <span class='fu'>parSapply</span>(<span class='fl'>1</span>:<span class='fl'>200</span>, <span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/mean'>mean</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/Uniform'>runif</a></span>(<span class='fl'>100</span>)))

<span class='co'># We simply call stopCluster as we would do with any other cluster</span>
<span class='co'># object</span>
<span class='fu'>stopCluster</span>(<span class='no'>ans</span>)

<span class='co'># We can also specify SBATCH options directly (...)</span>
<span class='no'>cl</span> <span class='kw'>&lt;-</span> <span class='fu'>makeSlurmCluster</span>(<span class='fl'>200</span>, <span class='kw'>partition</span> <span class='kw'>=</span> <span class='st'>"thomas"</span>, <span class='kw'>time</span> <span class='kw'>=</span> <span class='st'>"02:00:00"</span>)
<span class='fu'>stopCluster</span>(<span class='no'>cl</span>)

<span class='co'># Limited number of simultaneous jobs ---------------------------------------</span>
<span class='co'># Suppose that the user cannot run more than 10 jobs at a time. We can</span>
<span class='co'># increase the number of workers by increasing the number of child-sessions per job</span>

<span class='no'>cl</span> <span class='kw'>&lt;-</span> <span class='fu'>makeSlurmCluster</span>(<span class='fl'>9</span>, <span class='kw'>offspring_per_job</span> <span class='kw'>=</span> <span class='fl'>5</span>) <span class='co'># We leave one job as the master session.</span>

<span class='co'># This will have in total 45 child processes!</span>
<span class='no'>cl</span>

<span class='co'># }</span><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#maximum-number-of-connections">Maximum number of connections</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by George Vega Yon, National Cancer Institute (NCI).</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

